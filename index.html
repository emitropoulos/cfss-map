<!DOCTYPE html>
<html>
<head>
  <title>Dynamic Deals Map</title>
  <style>
    #map { height: 100vh; width: 100%; }
  </style>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAaOhoab-DD-DJ-TZ1m0eEqpKaUXkBFwbo"></script>
</head>
<body>
  <div id="map"></div>
  <script>
    let map;
    let markers = [];
    async function initMap() {
      map = new google.maps.Map(document.getElementById("map"), {
        center: { lat: 34.5, lng: -77.5 },
        zoom: 7
      });
      await loadMarkers();
    }
    async function loadMarkers() {
      markers.forEach(m => m.setMap(null));
      markers = [];
      try {
        const response = await fetch("https://script.google.com/macros/s/AKfycbx94ToLP7BpKl0duSIyaNdsJ5_fVN1GT0sIf5rdQjJ-20SmPqZN8gAI52oF5Dmfzaohyw/exec");
        const data = await response.json();
        data.forEach(d => {
          if(d.lat && d.lng){
            const marker = new google.maps.Marker({
              position: { 
                lat: Number(d.lat), 
                lng: Number(d.lng) },
              map: map,
              title: d.homeowner,
              icon: {
                path: google.maps.SymbolPath.CIRCLE,
                scale: 6,
                fillColor: "blue",
                fillOpacity: 1,
                strokeWeight: 0
              }
            });
            const infoContent = `
              <strong>Homeowner:</strong> ${d.homeowner}<br>
              <strong>Deal Owner:</strong> ${d.dealOwner}<br>
              <strong>Product:</strong> ${d.product}<br>
              <strong>Address:</strong> ${d.address}
            `;
            const infowindow = new google.maps.InfoWindow({ content: infoContent });
            marker.addListener("click", () => infowindow.open(map, marker));
            markers.push(marker);
          }
        });
      } catch(e) {
        console.error(e);
      }
    }
    window.onload = initMap;
  </script>
</body>
</html>
